<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>EXIS Exercise Algorithm Test</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
                    Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
                background: #000000;
                min-height: 100vh;
                padding: 20px;
            }

            .container {
                max-width: 1200px;
                margin: 0 auto;
                background: #ffffff;
                border-radius: 20px;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
                overflow: hidden;
            }

            .header {
                background: #000000;
                color: #ffffff;
                padding: 30px;
                text-align: center;
            }

            .header h1 {
                font-size: 2.5em;
                margin-bottom: 10px;
            }

            .header p {
                font-size: 1.1em;
                opacity: 0.9;
            }

            .content {
                padding: 40px;
            }

            /* Survey Styles */
            .survey-section {
                display: none;
            }

            .survey-section.active {
                display: block;
            }

            .question {
                margin-bottom: 30px;
            }

            .question h3 {
                color: #333;
                margin-bottom: 15px;
                font-size: 1.3em;
            }

            .question label {
                display: block;
                padding: 15px;
                background: #f8f9fa;
                border: 2px solid #e9ecef;
                border-radius: 10px;
                margin-bottom: 10px;
                cursor: pointer;
                transition: all 0.3s;
            }

            .question label:hover {
                background: #e9ecef;
                border-color: #000000;
            }

            .question input[type="radio"]:checked + label,
            .question input[type="checkbox"]:checked + label {
                background: #000000;
                color: #ffffff;
                border-color: #000000;
            }

            .question input[type="radio"],
            .question input[type="checkbox"] {
                display: none;
            }

            .question input[type="number"],
            .question input[type="text"] {
                width: 100%;
                padding: 12px;
                border: 2px solid #e9ecef;
                border-radius: 10px;
                font-size: 1em;
                margin-bottom: 10px;
            }

            .input-group {
                display: flex;
                gap: 15px;
                margin-bottom: 10px;
            }

            .input-group input {
                flex: 1;
            }

            .btn {
                background: #000000;
                color: #ffffff;
                border: none;
                padding: 15px 40px;
                border-radius: 10px;
                font-size: 1.1em;
                cursor: pointer;
                transition: transform 0.3s;
                margin-top: 20px;
            }

            .btn:hover {
                transform: translateY(-2px);
            }

            .btn:disabled {
                opacity: 0.5;
                cursor: not-allowed;
            }

            /* 결과 스타일 */
            .results-section {
                display: none;
            }

            .results-section.active {
                display: block;
            }

            .progress-bar-container {
                background: #f8f9fa;
                padding: 20px;
                border-radius: 10px;
                margin-bottom: 20px;
            }

            .progress-info {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 10px;
            }

            .day-progress {
                font-size: 1.5em;
                font-weight: bold;
                color: #000000;
            }

            .week-info {
                color: #666;
                font-size: 1.1em;
            }

            .progress-bar {
                height: 30px;
                background: #e9ecef;
                border-radius: 15px;
                overflow: hidden;
                position: relative;
            }

            .progress-fill {
                height: 100%;
                background: #000000;
                transition: width 0.5s;
                display: flex;
                align-items: center;
                justify-content: center;
                color: #ffffff;
                font-weight: bold;
            }

            .user-profile {
                background: #f8f9fa;
                padding: 20px;
                border-radius: 10px;
                margin-bottom: 20px;
            }

            .user-profile h3 {
                color: #000000;
                margin-bottom: 15px;
            }

            .profile-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 15px;
            }

            .profile-item {
                background: white;
                padding: 15px;
                border-radius: 8px;
            }

            .profile-item strong {
                display: block;
                color: #666;
                font-size: 0.9em;
                margin-bottom: 5px;
            }

            .profile-item span {
                font-size: 1.2em;
                color: #333;
            }

            .exp-bars {
                margin: 20px 0;
            }

            .exp-bar {
                margin-bottom: 15px;
            }

            .exp-label {
                display: flex;
                justify-content: space-between;
                margin-bottom: 5px;
                font-size: 0.9em;
            }

            .exp-progress {
                height: 20px;
                background: #e9ecef;
                border-radius: 10px;
                overflow: hidden;
                position: relative;
            }

            .exp-fill {
                height: 100%;
                background: #000000;
                transition: width 0.5s;
            }

            .exp-change {
                display: inline-block;
                margin-left: 10px;
                font-weight: bold;
                animation: fadeIn 0.5s;
            }

            .exp-change.positive {
                color: #000000;
            }

            .exp-change.negative {
                color: #000000;
            }

            @keyframes fadeIn {
                from {
                    opacity: 0;
                    transform: translateY(-10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            /* Daily Workout Card */
            .day-workout-card {
                background: #f8f9fa;
                border-radius: 15px;
                padding: 30px;
                margin-bottom: 20px;
            }

            .day-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 20px;
                padding-bottom: 15px;
                border-bottom: 3px solid #000000;
            }

            .day-title {
                font-size: 1.8em;
                font-weight: bold;
                color: #333;
            }

            .day-type {
                background: #000000;
                color: #ffffff;
                padding: 8px 20px;
                border-radius: 20px;
                font-size: 1em;
            }

            .rest-day {
                background: #000000;
            }

            .deload-day {
                background: #000000;
            }

            .rest-message {
                text-align: center;
                padding: 40px;
                font-size: 1.2em;
                color: #666;
            }

            .rest-message-icon {
                font-size: 3em;
                margin-bottom: 20px;
            }

            .exercise-list {
                list-style: none;
            }

            .exercise-item {
                background: #ffffff;
                padding: 20px;
                border-radius: 10px;
                margin-bottom: 15px;
                border-left: 5px solid #000000;
            }

            .exercise-name {
                font-weight: bold;
                font-size: 1.2em;
                color: #333;
                margin-bottom: 8px;
            }

            .exercise-details {
                color: #666;
                font-size: 1em;
                margin-bottom: 8px;
            }

            .exercise-tags {
                margin-bottom: 15px;
            }

            .tag {
                display: inline-block;
                background: #e9ecef;
                padding: 4px 10px;
                border-radius: 5px;
                font-size: 0.85em;
                margin-right: 8px;
                color: #666;
            }

            .feedback-section {
                margin-top: 15px;
                padding: 15px;
                background: #f0f0f0;
                border-radius: 8px;
            }

            .feedback-title {
                font-size: 0.95em;
                color: #000000;
                margin-bottom: 10px;
                font-weight: bold;
            }

            .feedback-buttons {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .feedback-btn {
                padding: 12px;
                border: none;
                border-radius: 8px;
                cursor: pointer;
                font-size: 0.95em;
                font-weight: bold;
                transition: transform 0.2s;
            }

            .feedback-btn:hover {
                transform: scale(1.05);
            }

            .feedback-btn:disabled {
                opacity: 0.5;
                cursor: not-allowed;
            }

            .feedback-easy {
                background: #ffffff;
                color: #000000;
                border: 1px solid #000000;
            }

            .feedback-good {
                background: #ffffff;
                color: #000000;
                border: 1px solid #000000;
            }

            .feedback-hard {
                background: #ffffff;
                color: #000000;
                border: 1px solid #000000;
            }

            .feedback-impossible {
                background: #ffffff;
                color: #000000;
                border: 1px solid #000000;
            }

            .feedback-result {
                margin-top: 15px;
                padding: 15px;
                background: #f0f0f0;
                border-radius: 8px;
                border-left: 4px solid #000000;
            }

            .next-day-btn {
                background: #000000;
                color: #ffffff;
                border: none;
                padding: 15px 40px;
                border-radius: 10px;
                font-size: 1.2em;
                cursor: pointer;
                width: 100%;
                margin-top: 20px;
                font-weight: bold;
                transition: transform 0.3s;
            }

            .next-day-btn:hover:not(:disabled) {
                transform: translateY(-2px);
            }

            .next-day-btn:disabled {
                opacity: 0.5;
                cursor: not-allowed;
            }

            .reset-btn {
                background: #ffffff;
                color: #000000;
                border: 1px solid #000000;
                padding: 12px 30px;
                border-radius: 8px;
                cursor: pointer;
                margin-top: 20px;
                font-size: 1em;
            }

            .completion-card {
                background: #000000;
                color: #ffffff;
                padding: 40px;
                border-radius: 15px;
                text-align: center;
            }

            .completion-card h2 {
                font-size: 2.5em;
                margin-bottom: 20px;
            }

            .completion-card p {
                font-size: 1.2em;
                line-height: 1.6;
            }

            .exp-changes-summary {
                background: white;
                color: #333;
                padding: 20px;
                border-radius: 10px;
                margin-top: 20px;
            }

            .exp-changes-summary h3 {
                color: #000000;
                margin-bottom: 15px;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>EXIS Exercise Algorithm Test</h1>
                <p>Daily progress and experience point tracking</p>
            </div>

            <div class="content">
                <!-- Initial Survey Section -->
                <div class="survey-section active" id="surveySection">
                    <h2 style="margin-bottom: 30px">Initial Survey</h2>

                    <!-- Question 1: Exercise Experience -->
                    <div class="question">
                        <h3>1. How long have you been exercising?</h3>
                        <input
                            type="radio"
                            name="experience"
                            id="exp1"
                            value="Beginner"
                        />
                        <label for="exp1">Beginner (less than 6 months)</label>

                        <input
                            type="radio"
                            name="experience"
                            id="exp2"
                            value="Intermediate"
                        />
                        <label for="exp2">Intermediate (6 months to 2 years)</label>

                        <input
                            type="radio"
                            name="experience"
                            id="exp3"
                            value="Advanced"
                        />
                        <label for="exp3">Advanced (2 years or more)</label>
                    </div>

                    <!-- Question 2: Main Lifts -->
                    <div class="question">
                        <h3>
                            2. Please provide your maximum lift weights (optional, kg)
                        </h3>
                        <div class="input-group">
                            <input
                                type="number"
                                id="squat"
                                placeholder="Squat"
                                min="0"
                            />
                            <input
                                type="number"
                                id="bench"
                                placeholder="Bench Press"
                                min="0"
                            />
                            <input
                                type="number"
                                id="deadlift"
                                placeholder="Deadlift"
                                min="0"
                            />
                        </div>
                    </div>

                    <!-- Question 3: Body Information -->
                    <div class="question">
                        <h3>3. Please provide your body information (optional)</h3>
                        <div class="input-group">
                            <input
                                type="number"
                                id="height"
                                placeholder="Height (cm)"
                                min="100"
                                max="250"
                            />
                            <input
                                type="number"
                                id="weight"
                                placeholder="Weight (kg)"
                                min="30"
                                max="200"
                            />
                        </div>
                    </div>

                    <!-- Question 4: Weekly Exercise Frequency -->
                    <div class="question">
                        <h3>4. How many times per week do you exercise on average?</h3>
                        <input
                            type="radio"
                            name="frequency"
                            id="freq1"
                            value="3"
                        />
                        <label for="freq1">3 times per week</label>

                        <input
                            type="radio"
                            name="frequency"
                            id="freq2"
                            value="4"
                        />
                        <label for="freq2">4 times per week</label>

                        <input
                            type="radio"
                            name="frequency"
                            id="freq3"
                            value="5"
                        />
                        <label for="freq3">5 times per week</label>

                        <input
                            type="radio"
                            name="frequency"
                            id="freq4"
                            value="6"
                        />
                        <label for="freq4">6 times per week</label>
                    </div>

                    <!-- Question 5: Exercise Environment -->
                    <div class="question">
                        <h3>5. What environment do you exercise in?</h3>
                        <input
                            type="radio"
                            name="environment"
                            id="env1"
                            value="Bodyweight"
                        />
                        <label for="env1">Bodyweight Only</label>

                        <input
                            type="radio"
                            name="environment"
                            id="env2"
                            value="Gym"
                        />
                        <label for="env2">Gym</label>

                        <input
                            type="radio"
                            name="environment"
                            id="env3"
                            value="Equipment"
                        />
                        <label for="env3"
                            >Bodyweight + Equipment (bands, dumbbells, etc.)</label
                        >
                    </div>

                    <!-- Question 6: Exercise Goal -->
                    <div class="question">
                        <h3>6. What is your exercise goal?</h3>
                        <input
                            type="radio"
                            name="goal"
                            id="goal1"
                            value="Weight Loss"
                        />
                        <label for="goal1">Weight Loss (fat reduction)</label>

                        <input
                            type="radio"
                            name="goal"
                            id="goal2"
                            value="Muscle Gain"
                        />
                        <label for="goal2">Muscle Gain (bulking)</label>

                        <input
                            type="radio"
                            name="goal"
                            id="goal3"
                            value="Performance"
                        />
                        <label for="goal3">Performance Improvement (endurance, strength)</label>
                    </div>

                    <!-- Question 7: Focus Areas -->
                    <div class="question">
                        <h3>
                            7. Are there any specific areas you want to focus on? (multiple selection possible)
                        </h3>
                        <input
                            type="checkbox"
                            name="focus"
                            id="focus1"
                            value="Chest"
                        />
                        <label for="focus1">Chest</label>

                        <input
                            type="checkbox"
                            name="focus"
                            id="focus2"
                            value="Back"
                        />
                        <label for="focus2">Back</label>

                        <input
                            type="checkbox"
                            name="focus"
                            id="focus3"
                            value="Shoulders"
                        />
                        <label for="focus3">Shoulders</label>

                        <input
                            type="checkbox"
                            name="focus"
                            id="focus4"
                            value="Arms"
                        />
                        <label for="focus4">Arms</label>

                        <input
                            type="checkbox"
                            name="focus"
                            id="focus5"
                            value="Abs"
                        />
                        <label for="focus5">Abs</label>

                        <input
                            type="checkbox"
                            name="focus"
                            id="focus6"
                            value="Legs"
                        />
                        <label for="focus6">Legs</label>

                        <input
                            type="checkbox"
                            name="focus"
                            id="focus7"
                            value="None"
                        />
                        <label for="focus7">I want to exercise all areas evenly</label>
                    </div>

                    <button class="btn" onclick="startProgram()">
                        Start Program
                    </button>
                </div>

                <!-- 결과 섹션 -->
                <div class="results-section" id="resultsSection">
                    <div class="progress-bar-container">
                        <div class="progress-info">
                            <div class="day-progress" id="dayProgress">
                                Day 1 / 28
                            </div>
                            <div class="week-info" id="weekInfo">Week 1</div>
                        </div>
                        <div class="progress-bar">
                            <div
                                class="progress-fill"
                                id="progressFill"
                                style="width: 0%"
                            >
                                0%
                            </div>
                        </div>
                    </div>

                    <div class="user-profile" id="userProfile"></div>

                    <div id="dayWorkoutContainer"></div>

                    <button class="reset-btn" onclick="resetProgram()">
                        Return to Start
                    </button>
                </div>
            </div>
        </div>

        <script>
            // Exercise Database
            const exerciseDatabase = [
                {
                    name: "Push-up",
                    environment: ["Bodyweight", "Equipment"],
                    bodyParts: ["Chest", "Shoulders", "Arms", "Core"],
                    levels: ["Beginner", "Intermediate", "Advanced"],
                },
                {
                    name: "Bear Push-up",
                    environment: ["Bodyweight", "Equipment"],
                    bodyParts: ["Chest", "Shoulders", "Arms", "Core"],
                    levels: ["Beginner"],
                },
                {
                    name: "Knee Push-up",
                    environment: ["Bodyweight", "Equipment"],
                    bodyParts: ["Chest", "Shoulders", "Arms", "Core"],
                    levels: ["Beginner"],
                },
                {
                    name: "Pike Push-up",
                    environment: ["Bodyweight", "Equipment"],
                    bodyParts: ["Chest", "Back", "Arms", "Core"],
                    levels: ["Intermediate", "Advanced"],
                },
                {
                    name: "Push-up Row",
                    environment: ["Bodyweight", "Equipment"],
                    bodyParts: ["Chest", "Back", "Arms", "Core"],
                    levels: ["Intermediate", "Advanced"],
                },
                {
                    name: "Knee Push-up Row",
                    environment: ["Bodyweight", "Equipment"],
                    bodyParts: ["Chest", "Back", "Arms", "Core"],
                    levels: ["Beginner"],
                },
                {
                    name: "Decline Push-up",
                    environment: ["Bodyweight", "Equipment"],
                    bodyParts: ["Chest", "Shoulders", "Arms", "Core"],
                    levels: ["Intermediate", "Advanced"],
                },
                {
                    name: "Knee Decline Push-up",
                    environment: ["Bodyweight", "Equipment"],
                    bodyParts: ["Chest", "Shoulders", "Arms", "Core"],
                    levels: ["Beginner", "Intermediate", "Advanced"],
                },
                {
                    name: "Archer Push-up",
                    environment: ["Bodyweight", "Equipment"],
                    bodyParts: ["Chest", "Shoulders", "Arms", "Core"],
                    levels: ["Advanced"],
                },
                {
                    name: "Plank",
                    environment: ["Bodyweight", "Equipment"],
                    bodyParts: ["Core", "Abs"],
                    levels: ["Beginner", "Intermediate", "Advanced"],
                },
                {
                    name: "Knee Plank",
                    environment: ["Bodyweight", "Equipment"],
                    bodyParts: ["Core", "Abs"],
                    levels: ["Beginner"],
                },
                {
                    name: "Side Plank",
                    environment: ["Bodyweight", "Equipment"],
                    bodyParts: ["Core", "Abs"],
                    levels: ["Beginner", "Intermediate", "Advanced"],
                },
                {
                    name: "Baby Plank",
                    environment: ["Bodyweight", "Equipment"],
                    bodyParts: ["Core", "Abs"],
                    levels: ["Beginner", "Intermediate", "Advanced"],
                },
                {
                    name: "Bear Plank",
                    environment: ["Bodyweight", "Equipment"],
                    bodyParts: ["Core", "Abs"],
                    levels: ["Intermediate", "Advanced"],
                },
                {
                    name: "Sit-up",
                    environment: ["Bodyweight", "Equipment"],
                    bodyParts: ["Core", "Abs"],
                    levels: ["Intermediate", "Advanced"],
                },
                {
                    name: "Leg Raise",
                    environment: ["Bodyweight", "Equipment"],
                    bodyParts: ["Core", "Abs"],
                    levels: ["Beginner", "Intermediate", "Advanced"],
                },
                {
                    name: "Crunch",
                    environment: ["Bodyweight", "Equipment"],
                    bodyParts: ["Core", "Abs"],
                    levels: ["Beginner", "Intermediate", "Advanced"],
                },
                {
                    name: "V-up",
                    environment: ["Bodyweight", "Equipment"],
                    bodyParts: ["Core", "Abs"],
                    levels: ["Beginner", "Intermediate", "Advanced"],
                },
                {
                    name: "Dead Bug",
                    environment: ["Bodyweight", "Equipment"],
                    bodyParts: ["Core"],
                    levels: ["Beginner", "Intermediate", "Advanced"],
                },
                {
                    name: "Squat",
                    environment: ["Bodyweight", "Equipment", "Gym"],
                    bodyParts: ["Legs"],
                    levels: ["Beginner", "Intermediate", "Advanced"],
                },
                {
                    name: "Overhead Squat",
                    environment: ["Bodyweight", "Equipment", "Gym"],
                    bodyParts: ["Legs"],
                    levels: ["Beginner", "Intermediate", "Advanced"],
                },
                {
                    name: "Split Squat",
                    environment: ["Bodyweight", "Equipment", "Gym"],
                    bodyParts: ["Legs"],
                    levels: ["Beginner", "Intermediate", "Advanced"],
                },
                {
                    name: "Pistol Squat",
                    environment: ["Bodyweight", "Equipment"],
                    bodyParts: ["Legs", "Core"],
                    levels: ["Beginner", "Intermediate", "Advanced"],
                },
                {
                    name: "Lunge Twist",
                    environment: ["Bodyweight", "Equipment", "Gym"],
                    bodyParts: ["Legs", "Core"],
                    levels: ["Beginner", "Intermediate", "Advanced"],
                },
                {
                    name: "Lunge",
                    environment: ["Bodyweight", "Equipment", "Gym"],
                    bodyParts: ["Legs"],
                    levels: ["Beginner", "Intermediate", "Advanced"],
                },
                {
                    name: "Reverse Lunge",
                    environment: ["Bodyweight", "Equipment", "Gym"],
                    bodyParts: ["Legs"],
                    levels: ["Beginner", "Intermediate", "Advanced"],
                },
            ];

            // User data and experience points
            let userData = {
                experience: "",
                lifts: { squat: 0, bench: 0, deadlift: 0 },
                body: { height: 0, weight: 0 },
                frequency: 0,
                environment: "",
                goal: "",
                focusAreas: [],
                bodyPartExp: {
                    Chest: 50,
                    Back: 50,
                    Shoulders: 50,
                    Arms: 50,
                    Abs: 50,
                    Legs: 50,
                    Core: 50,
                },
            };

            let currentDay = 1;
            let currentWeek = 1;
            let currentDayData = null;
            let feedbackGiven = false;
            let expChanges = {};
            let recentBodyParts = [];

            // Collect survey data and start program
            function startProgram() {
                // Check required questions
                const experience = document.querySelector(
                    'input[name="experience"]:checked'
                );
                const frequency = document.querySelector(
                    'input[name="frequency"]:checked'
                );
                const environment = document.querySelector(
                    'input[name="environment"]:checked'
                );
                const goal = document.querySelector(
                    'input[name="goal"]:checked'
                );

                if (!experience || !frequency || !environment || !goal) {
                    alert("Please answer all required questions!");
                    return;
                }

                // Collect data
                userData.experience = experience.value;
                userData.frequency = parseInt(frequency.value);
                userData.environment = environment.value;
                userData.goal = goal.value;

                // Optional data
                userData.lifts.squat =
                    parseInt(document.getElementById("squat").value) || 0;
                userData.lifts.bench =
                    parseInt(document.getElementById("bench").value) || 0;
                userData.lifts.deadlift =
                    parseInt(document.getElementById("deadlift").value) || 0;
                userData.body.height =
                    parseInt(document.getElementById("height").value) || 0;
                userData.body.weight =
                    parseInt(document.getElementById("weight").value) || 0;

                // Focus areas
                const focusCheckboxes = document.querySelectorAll(
                    'input[name="focus"]:checked'
                );
                userData.focusAreas = Array.from(focusCheckboxes).map(
                    (cb) => cb.value
                );

                // Set initial experience
                setInitialExperience();

                // Switch UI
                document
                    .getElementById("surveySection")
                    .classList.remove("active");
                document
                    .getElementById("resultsSection")
                    .classList.add("active");

                // Display user profile
                displayUserProfile();

                // Show first day
                showDay(1);
            }

            // Set initial experience
            function setInitialExperience() {
                let baseExp = 50;

                // Base experience based on exercise history
                if (userData.experience === "Beginner") {
                    baseExp = 30;
                } else if (userData.experience === "Intermediate") {
                    baseExp = 60;
                } else if (userData.experience === "Advanced") {
                    baseExp = 85;
                }

                // Reflect lift weights
                if (
                    userData.lifts.squat > 0 ||
                    userData.lifts.bench > 0 ||
                    userData.lifts.deadlift > 0
                ) {
                    const avgLift =
                        (userData.lifts.squat +
                            userData.lifts.bench +
                            userData.lifts.deadlift) /
                        3;
                    if (userData.body.weight > 0) {
                        const ratio = avgLift / userData.body.weight;
                        if (ratio > 1.5) baseExp = Math.min(baseExp + 15, 95);
                        else if (ratio > 1.0)
                            baseExp = Math.min(baseExp + 10, 90);
                    }
                }

                // Reflect exercise frequency
                if (userData.frequency >= 5) {
                    baseExp = Math.min(baseExp + 5, 95);
                }

                // Apply base experience to all body parts
                for (let part in userData.bodyPartExp) {
                    userData.bodyPartExp[part] = baseExp;
                }

                // Focus areas start slightly lower
                if (
                    !userData.focusAreas.includes("None") &&
                    userData.focusAreas.length > 0
                ) {
                    userData.focusAreas.forEach((area) => {
                        if (userData.bodyPartExp[area]) {
                            userData.bodyPartExp[area] = Math.max(
                                baseExp - 10,
                                20
                            );
                        }
                    });
                }
            }

            // Select next body part (real-time experience reflection)
            function selectNextBodyPart() {
                const allBodyParts = [
                    "Chest",
                    "Back",
                    "Shoulders",
                    "Arms",
                    "Abs",
                    "Legs",
                ];

                // Exclude body parts exercised within the last 2 days
                const recentParts = recentBodyParts.slice(-2);

                // Filter available parts (not recently exercised)
                let availableParts = allBodyParts.filter(
                    (part) => !recentParts.includes(part)
                );

                // If all parts were recently exercised, select from all
                if (availableParts.length === 0) {
                    availableParts = [...allBodyParts];
                }

                let selectedPart;

                // Experience-based weighted probability model
                if (
                    userData.focusAreas.length > 0 &&
                    !userData.focusAreas.includes("None")
                ) {
                    // Prioritize focus areas with lower experience
                    const focusAvailable = availableParts.filter((part) =>
                        userData.focusAreas.includes(part)
                    );

                    if (focusAvailable.length > 0 && Math.random() < 0.65) {
                        // 65% probability for focus areas
                        // Higher probability for lower experience parts
                        selectedPart = selectByExpWeight(focusAvailable, true);
                    } else {
                        // 35% probability for general areas
                        selectedPart = selectByExpWeight(availableParts, false);
                    }
                } else {
                    // If no focus areas, distribute evenly
                    selectedPart = selectByExpWeight(availableParts, false);
                }

                // Ensure legs are exercised at least once per week
                const currentWeekStart = Math.floor((currentDay - 1) / 7) * 7;
                const currentWeekParts = recentBodyParts.slice(
                    Math.max(
                        0,
                        recentBodyParts.length - (currentDay - currentWeekStart)
                    )
                );

                if (
                    currentDay % 7 === 6 && // Second to last day of week
                    !currentWeekParts.includes("Legs") &&
                    availableParts.includes("Legs")
                ) {
                    selectedPart = "Legs";
                }

                return selectedPart;
            }

            // Select body part based on experience weight
            function selectByExpWeight(parts, preferLowExp) {
                if (parts.length === 0) return null;
                if (parts.length === 1) return parts[0];

                // Collect experience for each part
                const weights = parts.map((part) => {
                    const exp = userData.bodyPartExp[part] || 50;
                    // Lower experience = higher weight (needs focused training)
                    if (preferLowExp) {
                        return 100 - exp + 10; // Minimum weight 10
                    } else {
                        return 60; // Even distribution
                    }
                });

                // Weighted random selection
                const totalWeight = weights.reduce((a, b) => a + b, 0);
                let random = Math.random() * totalWeight;

                for (let i = 0; i < parts.length; i++) {
                    random -= weights[i];
                    if (random <= 0) {
                        return parts[i];
                    }
                }

                return parts[parts.length - 1];
            }

            // Determine if workout day or rest day
            function isWorkoutDay() {
                const currentWeekStart =
                    Math.floor((currentDay - 1) / 7) * 7 + 1;
                const dayInWeek = currentDay - currentWeekStart + 1;

                // Calculate workouts done this week
                const workoutsThisWeek = recentBodyParts.slice(
                    Math.max(0, recentBodyParts.length - (dayInWeek - 1))
                ).length;

                return workoutsThisWeek < userData.frequency;
            }

            // Display day
            function showDay(dayNumber) {
                currentDay = dayNumber;
                currentWeek = Math.ceil(dayNumber / 7);
                feedbackGiven = false;
                expChanges = {};

                // Update progress
                updateProgress();

                // Determine if workout day or rest day
                if (!isWorkoutDay()) {
                    displayRestDay();
                } else {
                    // Select next body part in real-time (experience reflection)
                    const selectedBodyPart = selectNextBodyPart();

                    // Generate exercises
                    const exercises = generateDayExercises(
                        currentWeek,
                        selectedBodyPart
                    );

                    currentDayData = {
                        type: currentWeek === 4 ? "deload" : "workout",
                        bodyPart: selectedBodyPart,
                        exercises: exercises,
                    };

                    displayWorkoutDay();
                }

                // Update experience bars
                updateExpBars();
            }

            // Update progress
            function updateProgress() {
                const progress = ((currentDay - 1) / 28) * 100;
                document.getElementById(
                    "dayProgress"
                ).textContent = `Day ${currentDay} / 28`;
                document.getElementById(
                    "weekInfo"
                ).textContent = `Week ${currentWeek}${
                    currentWeek === 4 ? " (Deload Week)" : ""
                }`;
                document.getElementById("progressFill").style.width =
                    progress + "%";
                document.getElementById("progressFill").textContent =
                    Math.round(progress) + "%";
            }

            // Display rest day
            function displayRestDay() {
                const container = document.getElementById(
                    "dayWorkoutContainer"
                );
                container.innerHTML = `
                <div class="day-workout-card">
                    <div class="day-header">
                        <div class="day-title">Day ${currentDay} - Rest Day</div>
                        <div class="day-type rest-day">Rest</div>
                    </div>
                    <div class="rest-message">
                        <p>Today is a recovery day.</p>
                        <p>Get plenty of rest and proper nutrition!</p>
                    </div>
                </div>
                <button class="next-day-btn" onclick="goToNextDay()">
                    ${currentDay < 28 ? "Go to Next Day →" : "Program Complete!"}
                </button>
            `;
            }

            // Display workout day
            function displayWorkoutDay() {
                const container = document.getElementById(
                    "dayWorkoutContainer"
                );
                const typeLabel =
                    currentDayData.type === "deload" ? "Recovery Workout" : "Workout";
                const typeClass =
                    currentDayData.type === "deload" ? "deload-day" : "";

                let html = `
                <div class="day-workout-card">
                    <div class="day-header">
                        <div class="day-title">Day ${currentDay} - ${currentDayData.bodyPart} Focus</div>
                        <div class="day-type ${typeClass}">${typeLabel}</div>
                    </div>
                    <ul class="exercise-list">
            `;

                currentDayData.exercises.forEach((exercise, idx) => {
                    html += `
                    <li class="exercise-item">
                        <div class="exercise-name">${idx + 1}. ${
                        exercise.name
                    }</div>
                        <div class="exercise-details">${exercise.sets} sets × ${
                        exercise.reps
                    } reps</div>
                        <div class="exercise-tags">
                            ${exercise.bodyParts
                                .map(
                                    (part) => `<span class="tag">${part}</span>`
                                )
                                .join("")}
                        </div>
                        <div class="feedback-section">
                            <div class="feedback-title">How was the difficulty of this exercise?</div>
                            <div class="feedback-buttons">
                                <button class="feedback-btn feedback-easy" onclick="submitFeedback(${idx}, 'easy')">Too Easy</button>
                                <button class="feedback-btn feedback-good" onclick="submitFeedback(${idx}, 'good')">Just Right</button>
                                <button class="feedback-btn feedback-hard" onclick="submitFeedback(${idx}, 'hard')">Hard</button>
                                <button class="feedback-btn feedback-impossible" onclick="submitFeedback(${idx}, 'impossible')">Impossible</button>
                            </div>
                            <div id="feedback-result-${idx}"></div>
                        </div>
                    </li>
                `;
                });

                html += `
                    </ul>
                </div>
                <button class="next-day-btn" id="nextDayBtn" onclick="goToNextDay()" disabled>
                    ${
                        currentDay < 28
                            ? "Provide feedback for all exercises to proceed to next day"
                            : "Program Complete!"
                    }
                </button>
            `;

                container.innerHTML = html;
            }

            // Generate daily exercises (real-time experience reflection)
            function generateDayExercises(weekNumber, targetBodyPart) {
                if (!targetBodyPart) return [];

                const isDeload = weekNumber === 4;

                // Check current experience for body part
                const bodyPartExp = userData.bodyPartExp[targetBodyPart] || 50;

                // Set number of exercises per week
                let numExercises;
                if (weekNumber === 1) {
                    numExercises = 3;
                } else if (weekNumber === 2 || weekNumber === 3) {
                    numExercises = 4;
                } else {
                    numExercises = 3; // Deload
                }

                // Determine difficulty level based on experience
                let targetLevels = [];
                if (bodyPartExp < 40) {
                    targetLevels = ["Beginner"];
                } else if (bodyPartExp < 70) {
                    targetLevels = ["Beginner", "Intermediate"];
                } else {
                    targetLevels = ["Intermediate", "Advanced"];
                }

                // Filter exercises (body part, environment, level)
                const availableExercises = exerciseDatabase.filter(
                    (ex) =>
                        ex.bodyParts.some(
                            (part) =>
                                part === targetBodyPart ||
                                part === "Core" ||
                                (targetBodyPart.includes("Abs") &&
                                    part === "Abs")
                        ) &&
                        ex.environment.includes(userData.environment) &&
                        ex.levels.some((level) => targetLevels.includes(level))
                );

                // Relax level restrictions if not enough exercises
                if (availableExercises.length < numExercises) {
                    const fallbackExercises = exerciseDatabase.filter(
                        (ex) =>
                            ex.bodyParts.some(
                                (part) =>
                                    part === targetBodyPart ||
                                    part === "Core" ||
                                    (targetBodyPart.includes("Abs") &&
                                        part === "Abs")
                            ) && ex.environment.includes(userData.environment)
                    );
                    availableExercises.push(...fallbackExercises);
                }

                const selectedExercises = [];
                const exercisesCopy = [...availableExercises];
                // 중복 제거
                const uniqueExercises = exercisesCopy.filter(
                    (ex, idx, self) =>
                        idx === self.findIndex((e) => e.name === ex.name)
                );

                for (
                    let i = 0;
                    i < numExercises && uniqueExercises.length > 0;
                    i++
                ) {
                    const randomIndex = Math.floor(
                        Math.random() * uniqueExercises.length
                    );
                    const exercise = uniqueExercises[randomIndex];
                    uniqueExercises.splice(randomIndex, 1);

                    // Calculate sets and reps based on experience ratio
                    const sets = calculateSets(weekNumber, bodyPartExp);
                    const reps = calculateReps(
                        weekNumber,
                        userData.goal,
                        isDeload,
                        bodyPartExp
                    );

                    selectedExercises.push({
                        name: exercise.name,
                        sets: sets,
                        reps: reps,
                        bodyParts: exercise.bodyParts,
                        feedbackGiven: false,
                    });
                }

                return selectedExercises;
            }

            // Calculate sets (experience ratio reflection)
            function calculateSets(weekNumber, bodyPartExp) {
                let minSets, maxSets;

                // Set range per week
                if (weekNumber === 1) {
                    minSets = 3;
                    maxSets = 4.5;
                } else if (weekNumber === 2 || weekNumber === 3) {
                    minSets = 3;
                    maxSets = 4.5;
                } else {
                    // Deload week
                    minSets = 2.5;
                    maxSets = 4;
                }

                // Convert experience from 0-100 to 0-1 ratio
                const expRatio = bodyPartExp / 100;

                // Calculate sets based on experience ratio
                const targetSets = Math.round(
                    minSets + (maxSets - minSets) * expRatio
                );

                return Math.max(targetSets, minSets);
            }

            // Calculate reps (experience ratio reflection)
            function calculateReps(weekNumber, goal, isDeload, bodyPartExp) {
                if (isDeload) {
                    return 10; // Fixed for Deload
                }

                let minReps, maxReps;

                // Set min/max reps based on goal
                if (goal === "Weight Loss") {
                    minReps = 15;
                    maxReps = 20;
                } else if (goal === "Muscle Gain") {
                    minReps = 6;
                    maxReps = 10;
                } else {
                    // Performance
                    minReps = 8;
                    maxReps = 12;
                }

                // Convert experience from 0-100 to 0-1 ratio
                const expRatio = bodyPartExp / 100;

                // Calculate value between min and max based on experience ratio
                let targetReps = Math.round(
                    minReps + (maxReps - minReps) * expRatio
                );

                // Weekly progression (+1~2 reps)
                if (weekNumber === 2) {
                    targetReps += 1;
                } else if (weekNumber === 3) {
                    targetReps += 2;
                }

                // Ensure minimum value
                return Math.max(targetReps, minReps);
            }

            // Submit feedback
            function submitFeedback(exerciseIdx, feedbackType) {
                const exercise = currentDayData.exercises[exerciseIdx];

                if (exercise.feedbackGiven) {
                    return;
                }

                exercise.feedbackGiven = true;

                let message = "";
                let expChange = 0;

                if (feedbackType === "easy") {
                    message =
                        "Next time will be adjusted to a harder variation or higher intensity.";
                    expChange = 5;
                } else if (feedbackType === "good") {
                    message = "Current intensity is appropriate. Will continue to maintain.";
                    expChange = 2;
                } else if (feedbackType === "hard") {
                    message =
                        "It was a bit hard. Intensity will be slightly reduced or more practice needed.";
                    expChange = 1;
                } else if (feedbackType === "impossible") {
                    message =
                        "This exercise is still too difficult. Will be adjusted to an easier variation.";
                    expChange = -3;
                }

                // Save experience changes
                exercise.bodyParts.forEach((part) => {
                    if (userData.bodyPartExp[part] !== undefined) {
                        const oldExp = userData.bodyPartExp[part];
                        const newExp = Math.max(
                            0,
                            Math.min(100, oldExp + expChange)
                        );
                        userData.bodyPartExp[part] = newExp;

                        if (!expChanges[part]) expChanges[part] = 0;
                        expChanges[part] += expChange;
                    }
                });

                // Display feedback result
                const resultDiv = document.getElementById(
                    `feedback-result-${exerciseIdx}`
                );
                let expText = expChange > 0 ? `+${expChange}` : `${expChange}`;
                let expClass = expChange >= 0 ? "positive" : "negative";

                resultDiv.innerHTML = `
                <div class="feedback-result">
                    ${message}<br>
                    <strong>Experience Change: <span class="exp-change ${expClass}">${expText}</span></strong>
                    (${exercise.bodyParts.join(", ")} area)
                </div>
            `;

                // Disable all exercise feedback buttons
                const buttons =
                    resultDiv.previousElementSibling.querySelectorAll(
                        ".feedback-btn"
                    );
                buttons.forEach((btn) => (btn.disabled = true));

                // Update experience bars (also update profile)
                displayUserProfile();

                // Check if feedback given for all exercises
                checkAllFeedbackGiven();
            }

            // Check all feedback
            function checkAllFeedbackGiven() {
                const allGiven = currentDayData.exercises.every(
                    (ex) => ex.feedbackGiven
                );

                if (allGiven) {
                    const nextBtn = document.getElementById("nextDayBtn");
                    nextBtn.disabled = false;
                    nextBtn.textContent =
                        currentDay < 28
                            ? "Go to Next Day →"
                            : "Confirm Program Completion!";
                }
            }

            // Go to next day
            function goToNextDay() {
                // Add exercised body part to history
                if (currentDayData && currentDayData.bodyPart) {
                    recentBodyParts.push(currentDayData.bodyPart);

                    // Keep only last 7 days (1 week)
                    if (recentBodyParts.length > 7) {
                        recentBodyParts.shift();
                    }
                }

                if (currentDay >= 28) {
                    showCompletion();
                } else {
                    showDay(currentDay + 1);
                }
            }

            // Program completion
            function showCompletion() {
                const container = document.getElementById(
                    "dayWorkoutContainer"
                );

                let expSummary =
                    '<h3>Final Experience by Body Part</h3><div class="exp-bars">';
                for (let part in userData.bodyPartExp) {
                    const exp = userData.bodyPartExp[part];
                    expSummary += `
                    <div class="exp-bar">
                        <div class="exp-label">
                            <span>${part}</span>
                            <span>${exp}/100</span>
                        </div>
                        <div class="exp-progress">
                            <div class="exp-fill" style="width: ${exp}%"></div>
                        </div>
                    </div>
                `;
                }
                expSummary += "</div>";

                container.innerHTML = `
                <div class="completion-card">
                    <h2>28 Day Program Complete!</h2>
                    <p>Congratulations! You have completed a month-long journey.</p>
                    <p>Experience points have been adjusted based on feedback.</p>
                    <div class="exp-changes-summary">
                        ${expSummary}
                    </div>
                </div>
            `;
            }

            // Display user profile
            function displayUserProfile() {
                const profileDiv = document.getElementById("userProfile");

                let html = "<h3>User Profile and Experience by Body Part</h3>";
                html += '<div class="profile-grid">';
                html += `<div class="profile-item"><strong>Experience Level</strong><span>${userData.experience}</span></div>`;
                html += `<div class="profile-item"><strong>Exercise Frequency</strong><span>${userData.frequency} times per week</span></div>`;
                html += `<div class="profile-item"><strong>Exercise Environment</strong><span>${userData.environment}</span></div>`;
                html += `<div class="profile-item"><strong>Exercise Goal</strong><span>${userData.goal}</span></div>`;

                if (userData.body.height > 0 && userData.body.weight > 0) {
                    const bmi = (
                        userData.body.weight /
                        Math.pow(userData.body.height / 100, 2)
                    ).toFixed(1);
                    html += `<div class="profile-item"><strong>Body Type</strong><span>${userData.body.height}cm / ${userData.body.weight}kg</span></div>`;
                }

                if (
                    userData.focusAreas.length > 0 &&
                    !userData.focusAreas.includes("None")
                ) {
                    html += `<div class="profile-item"><strong>Focus Areas</strong><span>${userData.focusAreas.join(
                        ", "
                    )}</span></div>`;
                }

                html += "</div>";

                // Display recent exercise body part history
                if (recentBodyParts.length > 0) {
                    html +=
                        '<div style="margin-top: 20px; padding: 15px; background: white; border-radius: 8px;">';
                    html +=
                        '<strong style="color: #000000;">Recent Exercise Body Part History</strong>';
                    html +=
                        '<div style="margin-top: 10px; display: flex; gap: 8px; flex-wrap: wrap;">';
                    recentBodyParts.forEach((part, idx) => {
                        html += `<span class="tag" style="background: #000000; color: white;">Day ${
                            currentDay - recentBodyParts.length + idx + 1
                        }: ${part}</span>`;
                    });
                    html += "</div></div>";
                }

                html += '<div class="exp-bars" id="expBarsContainer"></div>';

                profileDiv.innerHTML = html;
                updateExpBars();
            }

            // Update experience bars
            function updateExpBars() {
                const container = document.getElementById("expBarsContainer");
                if (!container) return;

                let html = "";
                for (let part in userData.bodyPartExp) {
                    const exp = userData.bodyPartExp[part];
                    const change = expChanges[part] || 0;
                    const changeText =
                        change > 0
                            ? `+${change}`
                            : change < 0
                            ? `${change}`
                            : "";
                    const changeClass =
                        change > 0 ? "positive" : change < 0 ? "negative" : "";

                    html += `
                    <div class="exp-bar">
                        <div class="exp-label">
                            <span>${part}</span>
                            <span>
                                ${exp}/100
                                ${
                                    changeText
                                        ? `<span class="exp-change ${changeClass}">${changeText}</span>`
                                        : ""
                                }
                            </span>
                        </div>
                        <div class="exp-progress">
                            <div class="exp-fill" id="exp-fill-${part}" style="width: ${exp}%"></div>
                        </div>
                    </div>
                `;
                }
                container.innerHTML = html;
            }

            // Reset program
            function resetProgram() {
                if (
                    !confirm(
                        "Are you sure you want to return to the start? All progress will be reset."
                    )
                ) {
                    return;
                }

                document
                    .getElementById("resultsSection")
                    .classList.remove("active");
                document
                    .getElementById("surveySection")
                    .classList.add("active");

                // Reset form
                document
                    .querySelectorAll('input[type="radio"]')
                    .forEach((input) => (input.checked = false));
                document
                    .querySelectorAll('input[type="checkbox"]')
                    .forEach((input) => (input.checked = false));
                document
                    .querySelectorAll('input[type="number"]')
                    .forEach((input) => (input.value = ""));

                // Reset data
                userData = {
                    experience: "",
                    lifts: { squat: 0, bench: 0, deadlift: 0 },
                    body: { height: 0, weight: 0 },
                    frequency: 0,
                    environment: "",
                    goal: "",
                    focusAreas: [],
                    bodyPartExp: {
                        Chest: 50,
                        Back: 50,
                        Shoulders: 50,
                        Arms: 50,
                        Abs: 50,
                        Legs: 50,
                        Core: 50,
                    },
                };
                currentDay = 1;
                currentWeek = 1;
                recentBodyParts = [];
                currentDayData = null;
                feedbackGiven = false;
                expChanges = {};
            }
        </script>
    </body>
</html>
